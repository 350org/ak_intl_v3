{% load actionkit_tags %}
<div class="ak-privacy ak-errs-below">
{% comment %}
  "privacy" can only have a value of the AK hash, not null, not anything else.
	We need to capture data from opt-outs, to figure out what % of people take action without joining.
{% endcomment %}

{% if privacy_text.radio_optin and privacy_text.radio_optout %}
  <input type="hidden" name="require_opt_in" value="1">
  <script>
	  
    function setOptIn(opted_in) {
      if (opted_in) {
        actionkit.utils.appendHiddenInput('lists', '{{ page.list.id }}');
        jQuery('#really-opt-out').hide();
      }
      else {
        jQuery('input[name=lists]').remove()
        jQuery('#really-opt-out').show();
      }
    }
    
		var euCountries = [
			'Austria',
			'Belgium',
			'Bulgaria',
			'Czech Republic',
			'Cyprus',
			'Denmark',
			'Estonia',
			'Finland',
			'France',
			'Germany',
			'Greece',
			'Hungary',
			'Iceland',
			'Ireland',
			'Italy',
			'Latvia',
			'Liechtenstein',
			'Lithuania',
			'Luxembourg',
			'Malta',
			'Netherlands',
			'Norway',
			'Poland',
			'Portugal',
			'Romania',
			'Slovakia',
			'Slovenia',
			'Spain',
			'Sweden',
			'United Kingdom'
		];

jQuery(document).ready(function(){
	var countrySelect = jQuery("#country");
 	countrySelect.on('change',function(){
		var selectedCountry = jQuery(this).val()
		if ( euCountries.indexOf(selectedCountry) > -1 ){
			//jQuery(".privacy-eu").show();
			jQuery(".privacy-non_eu").hide();
			//console.log('show EU privacy');
		} else {
			//jQuery(".privacy-eu").hide();
			jQuery(".privacy-non_eu").show();
			//console.log('show non-EU privacy');
		}
	});
	
	jQuery("form").submit(function (e) {
    // If an opt-in option is not selected, prevent submit
    if (!jQuery('input[name="privacy"]').is(':checked')) {
        jQuery('.privacy-eu').addClass('privacy-ak-err');
        jQuery('#privacy-error').show();
        e.preventDefault();
        
        jQuery('input[name="privacy"]').click(function() {
					if(jQuery('input[name="privacy"]').is(':checked')) {
		        jQuery('.privacy-eu').removeClass('privacy-ak-err');
		        jQuery('#privacy-error').hide();						
					}
				});
    } else {
        jQuery('.privacy-eu').removeClass('privacy-ak-err');
        jQuery('#privacy-error').hide();
    }
  });
	
});
  </script>
	<style>
	#action-toc + .ak-privacy{
	  border-top:1px dotted rgba(255,255,255,0.4);
	  margin-top:1.1em;
	  padding-top:1.1em;}
	#really-opt-out{
		transition:300ms all;}
	
	.privacy-eu{
		padding: 5px;
	}
	
	.privacy-ak-err{
		background-color: #fff0d4;
		color: initial;
		margin: -1px 0 0;
		padding: 0.4rem 0.6rem;
		position: relative;		
	}
	
	ul#privacy-error {
    background-color: #fff0d4;
    color: initial;
    margin: -1px 0 0;
    padding: 0.4rem 0rem;
    position: relative;
	}	
	
	ul#privacy-error li {
    font-size: 0.85rem;
    line-height: 1.4;
    list-style-type: none;
	}
	
	ul#privacy-error li::before {
    background: #ffa902;
    border-radius: 1em;
    content: '';
    display: inline-block;
    height: 0.7em;
    margin-right: 0.4rem;
    width: 0.7em;
	}
	
	</style>
	<div class="privacy-eu">
	{% if privacy_text.notice %}
	  <div id="ak-fieldbox-privacy_notice" class="text-small2 margin-bottom-small">
	    <input type="hidden" id="privacy_notice" name="privacy" value="{{privacy_text.notice_hash}}">
			<p>{{privacy_text.notice|safe}}</p>
	  </div>
	{% endif %}
	  <div id="ak-fieldbox-privacy_radio" class="margin-bottom-normal input-radio text-lineheight-small">
	    <div>
				<input type="radio" id="privacy_optin" name="privacy" value="{{privacy_text.radio_optin_hash}}" onclick="setOptIn(true)">
	      <label for="privacy_optin">{{privacy_text.radio_optin|safe}}</label>
	    </div>
	    <div>
				<input type="radio" id="privacy_optout" name="privacy" value="{{privacy_text.radio_optout_hash}}" onclick="setOptIn(false)">
	      <label for="privacy_optout">{{privacy_text.radio_optout|safe}}</label>
	    </div>
	  </div>
	  <div id="really-opt-out" class="ak-nodisplay margin-bottom-normal padding-tiny text-small bg-dkgray-trans notch" style="display:none;">
	    <p>{% filter ak_text:"really_optout" %}
	      Are you sure? Email is how the global climate movement is able to stay organised. You can always unsubscribe!
	    {% endfilter %}</p>
			<p><label for="privacy_optin" class="button button-small button-secondary bg-teal">Yes, keep me involved</label></p>
	  </div>
    <ul id="privacy-error" style="display: none;"><li>{% filter ak_text:"select_option" %}Please select an option above.{% endfilter %}</li></ul>
	</div>
{% endif %}

</div>