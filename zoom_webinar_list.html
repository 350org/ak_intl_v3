{% extends "./wrapper.html" %}
{% load actionkit_tags %}
{% block content %}
<style>

.single-webinar-item-ctn{
    display: flex;
    width: 100%;
    max-height: 200px;
    padding: 1.5em;
    align-items: center;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

.single-webinar-item-ctn .left {
  max-width: 5.5em;
}

.single-webinar-item-ctn .middle {
  min-width: 80%;
  max-width: 80%;
}


.single-webinar-item-ctn .left {
    align-items: center;
    display: flex;
    flex-direction: column;
    height: 100%;
    border-right: 1px solid rgba(0,0,0,0.1);
    padding: 1em;
    margin: 0 1em 0 0;
    min-width: 5em;
}

.single-webinar-item-ctn .left .webinar-date{
  font-size: xx-large;
}
.single-webinar-item-ctn .left .webinar-day{
  text-transform: uppercase;
}

.webinar-day, .webinar-date {
  color: rgba(0,0,0,0.5);
}
.search-section {
    background: rgb(15,129,233);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction:column;
    padding: 2.5em 0;
    margin-bottom: 1em;
}

.search-section h4 {
  color: white;
  text-transform: uppercase;
  margin-bottom: 1em;
}

.search-ctn {
    width: 55%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    padding: 0 10px;
}

.search-ctn input {
  border: none;
}

.search-ctn input:focus {
  outline: none;
}

.search-ctn input::placeholder {
  outline: none;
  font-weight: normal;
}

.search-ctn button {
  border-radius: 2px;
}

.rsvp-webinar {
    background: white;
    border: 3px solid black;
    color: black !important;
    text-shadow: none !important;
    padding: .5em 2em;
    text-decoration: none;
    border-radius: 35px;
}

#loading-text{
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
}

.date-filters {
    display: flex;
    justify-content: space-evenly;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    font-weight: bold;
    font-size: small;
    margin-bottom: 2em;
}
.date-filters span {
  padding: 1em;
  transition: 0.1s all ease-in-out;
}

.date-filters span:hover {
  background: rgb(15,129,233, 0.1);
  cursor: pointer;
}

#no-webinars {
  text-align: center;
}

#simple embed process

        .lds-default {
            display: inline-block;
            position: relative;
            width: 64px;
            height: 64px;
        }

        .lds-default div {
            position: absolute;
            width: 5px;
            height: 5px;
            background: #0F81e9;
            border-radius: 50%;
            animation: lds-default 1.2s linear infinite;
        }

        .lds-default div:nth-child(1) {
            animation-delay: 0s;
            top: 29px;
            left: 53px;
        }

        .lds-default div:nth-child(2) {
            animation-delay: -0.1s;
            top: 18px;
            left: 50px;
        }

        .lds-default div:nth-child(3) {
            animation-delay: -0.2s;
            top: 9px;
            left: 41px;
        }

        .lds-default div:nth-child(4) {
            animation-delay: -0.3s;
            top: 6px;
            left: 29px;
        }

        .lds-default div:nth-child(5) {
            animation-delay: -0.4s;
            top: 9px;
            left: 18px;
        }

        .lds-default div:nth-child(6) {
            animation-delay: -0.5s;
            top: 18px;
            left: 9px;
        }

        .lds-default div:nth-child(7) {
            animation-delay: -0.6s;
            top: 29px;
            left: 6px;
        }

        .lds-default div:nth-child(8) {
            animation-delay: -0.7s;
            top: 41px;
            left: 9px;
        }

        .lds-default div:nth-child(9) {
            animation-delay: -0.8s;
            top: 50px;
            left: 18px;
        }

        .lds-default div:nth-child(10) {
            animation-delay: -0.9s;
            top: 53px;
            left: 29px;
        }

        .lds-default div:nth-child(11) {
            animation-delay: -1s;
            top: 50px;
            left: 41px;
        }

        .lds-default div:nth-child(12) {
            animation-delay: -1.1s;
            top: 41px;
            left: 50px;
        }

        @keyframes lds-default {

            0%,
            20%,
            80%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.5);
            }
      }

</style>
<div class="section bg-white form-style-expanded width-normal padding-medium">
    <div class="section search-section">
    <h4>350 Webinars</h4>
    <div class='search-ctn'>
    <input type="search" id="search-webinars" name="s" class="search-form-field c7" value="" placeholder="Search webinars by topic...">
    <button class='button button-primary'>SEARCH</button>
    </div>

    </div>
    <div class="section-inner">
    <div class="date-filters">
      <span>Filter ALL</span>
      <span>TODAY</span>
      <span>THIS WEEK</span>
      <span>THIS MONTH</span>
    </div>
    <ul id="ak-campaign-list">
    <div id="loading-text">
              <div class="lds-default">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
    </div>
    </div>
    </ul>
    <br/>
    </div>
    <div id="no-webinars" class="section-inner">
    <h5>No webinars found</h5>
    <p>We can't find any webinars based on your filter.</p>
    </div>
</div>
<script type="text/javascript">
      $(document).ready(function() {
        // Cache the campaign events here.
        let campaignEvents = [];
        let campaignDetails = {};
        let filteredCampaignEvents = [];
        // Get token and set it in local storage
        const token = localStorage.getItem("token");
        // $("#search-webinars").hide();
        $("#no-webinars").hide();
        const listCtn = $("#zoom-webinar-list")
        if(!token){
            console.log("ZAKI access token missing.")
            return;
        }
        const username = "kimani"
        const password = "royal94kimani";
        const headers = new Headers();
        // headers.set('Authorization', 'Basic ' + btoa(username + ":" + password));
        fetch("https://zaki-server.herokuapp.com/api/v1/ak-webinar-campaigns", {
          headers: {
            username,
            password,
            authorization: token
          }
        }, ()=>{

        }).then(data=>{
          if(data.ok){
            data.json().then(response=>{
              campaignEvents = response.data.campaignEvents;
              campaignDetails = response.data.campaignDetails;
              $("#search-webinars").show();
              showCampaignEvents(campaignEvents, campaignDetails);
            })
          }
        })
        .catch(e=>{
          console.log(e, "Error")
        });
        // Grab the campaign events.
        // Function
        const showCampaignEvents = (campaignEvents, campaignDetails) => {
          // Sort the list in descending order here.
          campaignEvents.objects.sort((a, b)=>( moment(a.starts_at).valueOf() > moment(b.starts_at).valueOf())? 1 : -1);
          if(campaignEvents.objects.length === 0){
              $("#no-webinars").show();
              return;
          }
          $("#no-webinars").hide();
          for(let i = 0 ; i < campaignEvents.objects.length ; i ++){
            const webinarAk = campaignEvents.objects[i];
              $("#loading-text").hide();
              $("#ak-campaign-list").append(`<li class="single-webinar-item-ctn">
                <div class='left'>
                <span class='webinar-day'>${window.moment(webinarAk.starts_at).format("ddd")}</span>
                <span class='webinar-date'>${window.moment(webinarAk.starts_at).format("D")}</span>
                <span class='webinar-day'>${window.moment(webinarAk.starts_at).format("MMM")}</span>
                </div>
                <div class='middle'>
                <h4>${webinarAk.title}</h4>
                <p>${window.moment(webinarAk.starts_at).format("ddd D MMM YYYY - HH:mm a ZZ")}</p>
                <p>${webinarAk.public_description || "No agenda set yet for this webinar."}</p>
                </div>
                <p class='right'>
                <a class="join-btn rsvp-webinar" target="__blank" href="https://act.350.org/event/${campaignDetails.name}_attend/${webinarAk.id}"> RSVP </a>
                </p>
              </li>`) 
          }
        };


        // search section
        $("#search-webinars").on('input', (event)=>{
          const searchTerm = event.target.value;
          if(searchTerm.length > 0){
          const filteredObjects = campaignEvents.objects.filter(event=>{
              return event.title.toLowerCase().replace(/ /g,"").trim().indexOf(searchTerm.toLowerCase().replace(/ /g,"").trim()) > -1
            });
          filteredCampaignEvents = {
            objects: filteredObjects
          }
          $("#ak-campaign-list").empty()
          showCampaignEvents(filteredCampaignEvents, campaignDetails)
          } else {
          $("#ak-campaign-list").empty()
          showCampaignEvents(campaignEvents, campaignDetails)
          }
        })
      })
</script>
{% endblock %}